#ifndef MAANET_PACKET_QUEUE_THREAD_H
#define MAANET_PACKET_QUEUE_THREAD_H

namespace maanet {

class packetQueueHandler {

public:
    virtual ~packetQueueHandler() {}
    virtual bool handlePacketQueue(packet *_packet, void *args) = 0;
};

class packetQueueThread : public maasys::defaultRunnable {
	
public:
    packetQueueThread();
    packetQueueThread(int threadCount, packetQueueHandler *handler, void *args);
	~packetQueueThread();

	void setThreadParameter(int threadCount, packetQueueHandler *handler, void *args);

	void stop(bool waitFinish = false);

	bool push(packet *packet, int maxQueueLen = 0, bool block = true);

	void pushQueue(packetQueue &packetQueue, int maxQueueLen = 0);

	void run(maasys::cThread *thread, void *arg);

	void setStatSpeed();

	void setWaitTime(int t);

	packet *head() {
		return _queue.head();
	}

	packet *tail() {
		return _queue.tail();
	}
	
	size_t size() {
		return _queue.size();
	}

private:
   	void checkSendSpeed();

private:
    packetQueue _queue;
	packetQueueHandler *_handler;
	maasys::threadCond _cond;
	maasys::threadCond _pushcond;

	void *_args;
	bool _waitFinish;      

	int _waitTime;
	int64_t _speed_t1;
	int64_t _speed_t2;
	int64_t _overage;

	bool _waiting;
};

}//namespace maanet

#endif//MAANET_PACKET_QUEUE_THREAD_H

